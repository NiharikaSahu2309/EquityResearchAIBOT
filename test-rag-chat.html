<!DOCTYPE html>
<html>
<head>
    <title>RAG Chat Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .loading { color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>RAG Chat Functionality Test</h1>
        
        <div class="test-section">
            <h2>Test 1: RAG Search Mode</h2>
            <p>This will search for "Suzlon revenue" in the uploaded documents.</p>
            <button onclick="testSearchMode()">Test Search Mode</button>
            <div id="searchResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 2: Agentic RAG Mode</h2>
            <p>This will use agentic reasoning to answer "What is Suzlon revenue in Q1 FY26?"</p>
            <button onclick="testAgenticMode()">Test Agentic Mode</button>
            <div id="agenticResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 3: Index Data Analysis</h2>
            <p>This will analyze the index data CSV file.</p>
            <button onclick="testIndexData()">Test Index Data</button>
            <div id="indexResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        async function testSearchMode() {
            const resultDiv = document.getElementById('searchResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Testing search mode...</div>';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('http://localhost:8085/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Suzlon revenue',
                        mode: 'search'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3>✅ Search Mode Success</h3>
                        <p><strong>Mode:</strong> ${data.metadata?.mode}</p>
                        <p><strong>Sources:</strong> ${JSON.stringify(data.metadata?.sources)}</p>
                        <p><strong>Results Count:</strong> ${data.metadata?.results_count}</p>
                        <p><strong>Response:</strong></p>
                        <div style="background: white; padding: 10px; border: 1px solid #ddd;">
                            ${data.message.substring(0, 500)}...
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>❌ Search Mode Failed</h3><p>${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Error</h3><p>${error.message}</p>`;
            }
        }
        
        async function testAgenticMode() {
            const resultDiv = document.getElementById('agenticResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Testing agentic mode (may take 30-60 seconds)...</div>';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('http://localhost:8085/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'What is Suzlon revenue in Q1 FY26?',
                        mode: 'agentic'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3>✅ Agentic Mode Success</h3>
                        <p><strong>Mode:</strong> ${data.metadata?.mode}</p>
                        <p><strong>Confidence:</strong> ${data.metadata?.confidence}</p>
                        <p><strong>Sources:</strong> ${JSON.stringify(data.metadata?.sources)}</p>
                        <p><strong>Plan:</strong> ${JSON.stringify(data.metadata?.plan)}</p>
                        <p><strong>Response:</strong></p>
                        <div style="background: white; padding: 10px; border: 1px solid #ddd;">
                            ${data.message}
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>❌ Agentic Mode Failed</h3><p>${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Error</h3><p>${error.message}</p>`;
            }
        }
        
        async function testIndexData() {
            const resultDiv = document.getElementById('indexResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Testing index data analysis...</div>';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('http://localhost:8085/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'What is the average closing price in the index data?',
                        mode: 'agentic'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3>✅ Index Data Analysis Success</h3>
                        <p><strong>Response:</strong></p>
                        <div style="background: white; padding: 10px; border: 1px solid #ddd;">
                            ${data.message}
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>❌ Index Data Analysis Failed</h3><p>${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Error</h3><p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
